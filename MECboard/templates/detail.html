<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gesipan Details</title>
<script>
function home(){
	location.href="/";
}
function update(){
	if ("{{is_authenticated}}" == "True"){
		if ("{{username}}" == "{{dto.writer}}"){
		document.form1.action="update_page";
		document.form1.submit();
		}
		else
			alert("글쓴이가 아닙니다");
	}
	else
		alert("로그인이 필요합니다");

}
function del(){
	if ("{{is_authenticated}}" == "True"){
		if ("{{is_superuser}}" == "True" || "{{username}}" == "{{dto.writer}}"){
			if(confirm("삭제하시겠습니까?")){
				document.form1.action="delete";
				document.form1.submit();
				}
		}
		else
			alert("글쓴이가 아닙니다");
	}
	else
		alert("로그인이 필요합니다");

}
function reply_insert(){
	if ("{{is_authenticated}}" == "True"){
		document.form2.submit();
    }
	else
		alert("로그인이 필 	요합니다");
}
</script>
</head>
<body>
<h2>게시물 내용</h2>
<form method="post" name="form1" enctype="multipart/form-data">
<table border="1" width="700px">
	<tr>
		<td>이름</td>
		<td>{{dto.writer}}</td>
	</tr>
	<tr>
		<td>제목</td>
		<td>{{dto.title}}</td>
	</tr>
	<tr>
		<td>날짜</td>
		<td>{{dto.post_date}}</td>
	</tr>
	<tr>
		<td>조회수</td>
		<td>{{dto.hit}}</td>
	</tr>
	<tr>
		<td>내용</td>
		<td>{{dto.content}}</td>
	</tr>
	<tr>
		<td>첨부파일</td>
		<td>
			{% if dto.filesize > 0 %}
			<a href="download?idx={{dto.idx}}">{{dto.filename}}</a>
			( {{filesize}}KB)
			{% endif %}
		</td>
	</tr>
	<tr>
		<td colspan="2" align="center">
			<input type="hidden" name="idx" value="{{dto.idx}}">
			<input type="button" value="목록" onclick="home()">
			<input type="button" value="수정" onclick="update()">
			<input type="button" value="삭제" onclick="del()">
		</td>
	</tr>
</table>
</form>

<form method="post" name="form2" action="reply_insert">
{% csrf_token %}
{{username}}<input type="hidden" name="writer" value="{{username}}"><br>
<textarea rows="5" cols="80" name="content"
	placeholder="댓글을 작성하세요."></textarea><br>
찬<input type="checkbox" name="rating" value="1"> 반<input type="checkbox" name="rating" value="2"> <br>
<input type="hidden" name="idx" value="{{dto.idx}}">
<input type="hidden" name="is_authenticated" value="{{is_authenticated}}">
<input type="hidden" name="username" value="{{username}}">
<input type="button" value="댓글쓰기" onclick="reply_insert()">
</form>

<table border="1" width="700px">
	{% for row in commentList %}
	{% if {{row.rating}} == 1 %}
	<tr align="left">
		<td>{{row.writer}} ( {{row.post_date}} ) ( 찬성 )<br>
			{{row.content}}
		</td>
	</tr>
	{% else %}
	<tr align="right">
		<td>{{row.writer}} ( {{row.post_date}} ) ( 반대 )<br>
			{{row.content}}
		</td>
	</tr>
	{% endif %}
	{% endfor %}
</table>
</body>
</html>